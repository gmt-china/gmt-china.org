---
title: "如何将 bash 脚本改成 bat 脚本"
date: 2018-04-01
categories:
    - GMT技巧
tags:
    - bash2bat
authors:
    - 赵志远
slug: bash2bat
---

社区提供的多是基于 Linux 下的 bash 脚本，有相当一部分用户并不熟悉 bash，因此有必要介绍
如何将 bash 脚本改成 Windows 下可用的 bat 脚本。

简单来说，将 bash 脚本改成 bat 脚本需要注意以下几点：
 
- 注释符号 `#`->`rem`
- 设置变量 `PS=MAP.PS`->`set PS=MAP.PS`
- 引用变量 `$PS`->`%PS%`
- 删除文件 `rm gmt.*`->`del gmt.*`

使用 notepad++ 编辑器编辑脚本可以很简单的利用 `Ctrl+F` 进行搜索替换。

比如搜索 `#` 并全部替换为 `rem ` ，搜索 `$PS` `$R` `$J` 分别替换为 `%PS%` `%R%` `%J%` 。

当然还有一些比较复杂的语句就需要你对 bat 比较熟悉。

比如 bash 下的嵌套命令可以将一条命令的结果作为变量使用 

```bash
T1=$(gmt grdinfo world6m.grd -T1000) 
gmt makecpt -Crainbow $T1 > 1.cpt
```

而在 bat 下就需要用 for 循环来实现

```bat
for /f %%i in ('gmt grdinfo world6m.grd -T1000') do set T1=%%i
gmt makecpt -Crainbow %T1% > 1.cpt
```

再比如 bash 下可以非常方便的进行多段文本的输入

```bash
# 被 EOF 包起来的两行文本将作为 gmt pslegend 的输入
gmt pslegend -R -J -F+gwhite+p0.2p,black -Dx4i/0i+w1i/0.6i+jBR+l1.2 -C0.2i/0.1i -B -O -K -V << EOF >> $PS
S 0.1i v2p+e+p0.1p,red 0.1i red 0.1p  0.2i 10 Mpa
S 0.1i - 0.2i - 0.8p,blue,- 0.3i Slab
EOF
```

在 bat 下则只能将两行文本先写入到文本中，再将文本作为命令的输入

```bat
echo S 0.1i v2p+e+p0.1p,red 0.1i red 0.1p  0.2i 10 Mpa > tmp
echo S 0.1i - 0.2i - 0.8p,blue,- 0.3i Slab >> tmp
gmt pslegend tmp -R -J -F+gwhite+p0.2p,black -Dx4i/0i+w1i/0.6i+jBR+l1.2 -C0.2i/0.1i -B -O -K -V >> %PS%
```

最后，如果脚本中出现了 grep、cut、wc、cat 等命令可以下载社区的 unixtools 工具包并解压缩到 GMT 安装路径的 bin 目录下，需要注意的是 bash 脚本中的 awk 需要更改为 gawk。

下面给出一个简单的 bash 脚本：

```bash
#!bin/bash
PS=example.ps
# 设置经纬度范围
R=-R108/125/33/43
# 设置投影方式
J=-JM6i
# 绘制底图
gmt psbasemap $R $J -B3 -K > $PS 
T1=$(gmt grdinfo huabei.grd -T100) 
gmt makecpt -Ctopo $T1 > huabei.cpt
# 绘制华北地形
gmt grdimage -R -J huabei.grd -Chuabei.cpt -K -O >> $PS
# 绘制台站分布
gmt psxy -R -J -St0.5c -Gblack -O >> $PS << EOF
112 36
120 40
115 39
EOF

# 删除临时文件
rm gmt.* huabei.cpt
```

按照上述方法修改成的 bat 脚本如下：

```bat
set PS=example.ps
rem 设置经纬度范围
set R=-R108/125/33/43
rem 设置投影方式
set J=-JM6i
rem 绘制底图
gmt psbasemap %R% %J% -B3 -K > %PS% 
for /f %%i in ('gmt grdinfo huabei.grd -T100') do set T1=%%i
gmt makecpt -Ctopo %T1% > huabei.cpt
rem 绘制华北地形
gmt grdimage -R -J huabei.grd -Chuabei.cpt -K -O >> %PS%
rem 绘制台站分布
echo 112 36 > tmp
echo 120 40 >> tmp
echo 115 39 >> tmp
gmt psxy tmp -R -J -St0.5c -Gblack -O >> %PS%

rem 删除临时文件
del gmt.* huabei.cpt tmp
```
